---
- name: Add tags to all tasks
  tags:
    - always
  block:
    - name: Create groups
      ansible.builtin.group:
        name: "{{ item.name }}"
        state: present
        gid: "{{ item.gid }}"
      loop: "{{ iris_groups }}"

    - name: Set root password
      ansible.builtin.user:
        name: root
        password: "{{ root_pw }}"
      when: root_pw is defined

    - name: Create users
      ansible.builtin.user:
        name: "{{ item.name }}"
        password: "{{ item.password | default(omit) }}"
        uid: "{{ item.uid | default(omit) }}"
        group: "{{ item.group | default(omit) }}"
        groups: "{{ item.groups | default(omit) }}"
        append: "{{ item.append | default(omit) }}"
        shell: "{{ item.shell | default(omit) }}"
      loop: "{{ iris_users }}"
